<link rel=import href="adebray-character-card.html">

<dom-module id="adebray-menu">
	<template>
		<style>
			:host {
				display: block;
				padding: 8px;
				margin: 4px;
				@apply(--layout-horizontal);
				@apply(--layout-center-justified);
			}

			.logo {
				width: 256px;
			}

			.button {
				width: 128px;
			}

			.centered {
				display: block;
				@apply(--layout-vertical);
				/*@apply(--layout-center-justified);*/
			}

		</style>


		<div id=menu class=centered>
			<iron-image src="/logo.png" alt="Awesome logo"></iron-image>

			<div class="layout horizontal" style="width:550px">
				<template is=dom-repeat items={{team}}>
					<adebray-character-card character={{item}}></adebray-character-card>
				</template>
			</div>

			<template is=dom-if	if="{{teamHasPlayer(team.length)}}">
				<paper-button class=button on-tap="toggleBattle" raised>Play</paper-button>
			</template>

			<template is=dom-if	if="{{teamNotFull(team.length)}}">
				<paper-button class=button on-tap="toggleTeam" raised>Team Up</paper-button>
				<iron-collapse id="play">
					<adebray-character-menu></adebray-character-menu>
					<paper-button on-tap="addToTeam" raised>Add</paper-button>
				</iron-collapse>
			</template>
			<paper-button class=button raised>Option</paper-button>
		</div>
	</template>
	<script>
		Polymer({
			is: 'adebray-menu',

			properties: {
				team: {
					type: Array,
					value: [],
					notify: true
				}
			},

			toggleTeam: function () {
				this.$$('#play').toggle()
			},

			toggleBattle: function () {
				this.$.menu.hidden = true

				let b = document.createElement('adebray-work')
				let e = monsters[0]

				console.log(e)
				b.callback_end = () => {
					this.$.menu.hidden = false
					this.set('team', null)

					this.async( function() {
						this.set('team', b.teamA)
					}, 100)

					this.removeChild(b)
				}

				this.team.forEach( e => e.actionJauge.fromNumber(0) )

				b.teamA = this.team
				b.teamB = [
					new Monster(e)
				]
				this.appendChild(b)
				// b.stage.run()
			},

			addToTeam: function () {
				let c = this.querySelector('adebray-character-menu').character
				this.querySelector('adebray-character-menu').fill()
				this.push('team', c)
			},

			getLen: function (team) {
				return team.length
			},

			teamNotFull: function (len) {
				return len < 4
			},
			teamHasPlayer: function (len) {
				return len >= 1
			},

			attached: function () {
				this.toggleTeam()
			}
		});
	</script>
</dom-module>
