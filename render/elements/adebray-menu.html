<link rel=import href="adebray-character-card.html">
<link rel=import href="../bower_components/iron-list/iron-list.html">
<link rel=import href="../bower_components/iron-image/iron-image.html">

<dom-module id="adebray-menu">
	<template>
		<style>
			:host {
				display: block;
				padding: 8px;
				margin: 4px;

				--padded-test {
					position: relative;
					left: -50px;
				}
				/*@apply(--layout-horizontal);*/
				/*@apply(--layout-center-justified);*/
			}

			.logo {
				width: 256px;
			}

			.button {
				width: 128px;
			}

			.vert {
				display: block;
				@apply(--layout-vertical);
			}

			.hori {
				@apply(--layout-horizontal);
			}

			.top {
				@apply(--layout-start);
			}

			.inline {
				/*border: 1px dashed blue;*/
				display: inline-block;
			}

			/*:host iron-list {
				border: 1px solid blue;
			}*/

			:host iron-image {
				width: 100px;
				height: 100px;
			}
		</style>

		<!-- <iron-localstorage name="teamStorage" value="{{team}}"></iron-localstorage> -->

		<div id=menu class="vert">
			<iron-image src="/logo.png" alt="Awesome logo"></iron-image>

			<template is=dom-if	if="{{teamHasPlayer(team.length)}}">
				<paper-button class=button on-tap="toggleBattle" raised>Play</paper-button>
			</template>

			<template is=dom-if	if="{{teamNotFull(team.length)}}">
				<paper-button class=button on-tap="toggleTeam" raised>Team Up</paper-button>
				<iron-collapse id="play">
					<adebray-character-menu></adebray-character-menu>
					<paper-button id="newCharacter" on-tap="addToTeam" raised>Add</paper-button>
				</iron-collapse>
			</template>

			<paper-button class=button raised>Option</paper-button>


		  <!-- <div class="layout horizontal">
			  <template is=dom-repeat items={{team}}>
				  <div class="inline" style="width: 49%" item={{item}}>
					  <adebray-character-card character={{item}}></adebray-character-card>
					  <paper-icon-button icon="delete" on-tap="deleteFromTeam"></paper-icon-button>
				  </div>
			  </template>
		  </div> -->
			<iron-list items={{team}}>
			<template>
				<div>
					<iron-image src="{{item.character.attrs.image.src}}"></iron-image>
					<paper-item class="inline">{{item.attrs.name}}</paper-item>
				</div>
			</template>
			</iron-list>

		</div>
	</template>
	<script>
		Polymer({
			is: 'adebray-menu',

			properties: {
				team: {
					type: Array,
					notify: true
				}
			},

			toggleTeam: function () {
				this.$$('#play').toggle()
			},

			toggleBattle: function () {
				this.$.menu.hidden = true

				let b = document.createElement('adebray-work')
				let e = monsters[0]

				console.log(e)
				b.callback_end = () => {
					this.$.menu.hidden = false
					this.set('team', null)

					this.async( function() {
						this.set('team', b.teamA)
					}, 100)

					this.removeChild(b)
				}

				this.team.forEach( e => {
					e.changeImage('right')
					e.actionJauge.fromNumber(0)
				})

				b.teamA = this.team
				b.teamB = []
				b.teamA.forEach( _ => {
					b.teamB.push( new Monster(e) )
				})
				this.appendChild(b)
			},

			addToTeam: function () {
				let c = this.querySelector('adebray-character-menu').character
				this.querySelector('adebray-character-menu').fill()
				console.dir(c.attrs.jobpoints)
				this.push('team', c)
			},

			deleteFromTeam: function (e) {
				var el = e.target
				while (el.tagName != 'DIV')
					el = el.parentNode

				this.splice('team', this.team.indexOf(el.item), 1)
			},

			getLen: function (team) {
				return team.length
			},

			teamNotFull: function (len) {
				return len < 32
			},
			teamHasPlayer: function (len) {
				return len >= 1
			},

			attached: function () {
				if (this.team == null)
					this.set('team', [])

				this.async( () => {
					this.addToTeam()
					this.async( () => {
						this.addToTeam()
						// this.async( () => this.toggleBattle(), 500 )
					}, 500)
				}, 1000)
			}
		});
	</script>
</dom-module>
