<link rel=import href=../bower_components/iron-localstorage/iron-localstorage.html>
<link rel=import href=../bower_components/iron-list/iron-list.html>
<link rel=import href=../bower_components/paper-item/paper-item.html>
<link rel=import href=../bower_components/iron-icons/iron-icons.html>
<link rel=import href=../bower_components/iron-image/iron-image.html>
<link rel=import href=../bower_components/paper-icon-button/paper-icon-button.html>

<link rel=import href=mdi.html>
<link rel=import href=adebray-config.html>
<link rel=import href=adebray-character-menu.html>

<script type="text/javascript" src="../scripts/BattleStage.js"></script>
<script type="text/javascript" src="../scripts/Character.js"></script>

<dom-module id="adebray-work">
	<template>

		<style>
			:host {
				padding: 8px;
				margin: 4px;
				display: block;
			}

			.centered {
				display: block;
				@apply(--layout-horizontal);
				@apply(--layout-center-justified);
			}

			.float {
				z-index: 1;
				background: lightgrey;
				position: absolute
			}

			.mode {
				left: 48px;
				position: absolute;
				z-index: 1;
			}

			.portrait {
				display: inline-block;
				border: 1px solid black;
				image-rendering: pixelated;
				width: 100px;
				height: 100px;
			}

			paper-tabs paper-tab {
				border: 1px solid black;
				display: inline-block;
			}

			#content {
				@apply(--layout-horizontal);
			}
		</style>
		<template is="dom-if" if="{{isOn(mode)}}">
			<paper-icon-button class=mode icon="mdi:pause" on-tap="toggle"></paper-icon-button>
		</template>
		<template is="dom-if" if="{{isOff(mode)}}">
			<paper-icon-button class=mode icon="mdi:play" on-tap="toggle"></paper-icon-button>
		</template>

		<adebray-config></adebray-config>
<!--
 		<div class="float">
			<paper-item>a dluhdil uhawlidu hawl duahiwudh lawiuhd laiu </paper-item>
			<paper-item>Item 2</paper-item>
			<paper-item>Item 3</paper-item>
			<paper-item>Item 4</paper-item>
		</div>
-->

		<!-- <iron-localstorage id='storage' name="{{key}}" value="{{storage}}"></iron-localstorage> -->

		<div class=centered>
			<div id='container'></div>
		</div>

		<div id='content'>
			<iron-image class='portrait' src="{{getSrc(selected)}}" preload sizing="cover"></iron-image>
			<paper-item>Fight</paper-item>
			<paper-item>Item</paper-item>
		</div>

		<div class=centered>
			<div class="layout vertical">
				<h3>Notes</h3>
				<p>gamemode</p>
			</div>
		</div>

		<div class=centered>
			<div class="layout vertical">
				<h3 class=centered>stack</h3>
				<template is=dom-repeat items={{stack}}>
					<paper-item>{{item}}</paper-item>
				</template>
			</div>
		</div>

	</template>

	<script>
		Polymer({
			is: 'adebray-work',

			properties: {
				teamA: {
					type: Array,
					value: [
						{
							position: 7,
							image: 'images2/combat_dummy/BODY_animation.png',
							class: 'Onion Knight'
						},{
							position: 7,
							image: 'images2/combat_dummy/BODY_animation.png',
							class: 'Onion Knight'
						}
					]
				},
				teamB: {
					type: Array,
					value: [
						{

							position: 1,
							image: 'images2/combat_dummy/BODY_animation.png',
							class: 'Onion Knight'
						},{

							position: 1,
							image: 'images2/combat_dummy/BODY_animation.png',
							class: 'Onion Knight'
						}
					]
				},
				key: String,
				storage: Object,

				mode: {
					type: Boolean,
					value: true
				},
				stack: Array,
				selected: Object
			},

			isOn: function (mode) {
				return mode === true
			},

			isOff: function (mode) {
				return mode === false
			},

			toggle: function () {
				this.mode = !this.mode
			},

			getSrc: function (character) {
				return character.children[0].attrs.image.src
			},

			attached: function () {
				var stage = new Konva.Stage({
					container : this.$$('#container'),
					width: 800,
					height: 600
				})
				var layer = new Konva.Layer()

				stage.add(layer)
				stage.on('contentClick', (e) => {
					console.log(e)
					// e.cancelBubble = true
					// this.set('selected', {
					// 	children: [ { attrs: { image: { src: ""} } } ]
					// })
				})

				let bs = new BattleStage({
					layer,
					teamA: this.teamA,
					teamB: this.teamB,
					callback: (bs) => this.set('stack', bs.stack)
				})
				let render = () => {
					if (this.mode) {
						bs.update()
					}
					requestAnimationFrame(render)
				}

				render()
			}
		});
	</script>
</dom-module>
