<link rel=import href="adebray-color/color-hash.html">
<link rel=import href="adebray-color/color-dot.html">

<dom-module id="adebray-skill-tree">
	<template>
		<style>
			:host {
				display: inline-block;
			}
		</style>


		<div id=head>
			<color-hash></color-hash>
		</div>

		<div class=centered>
			<div id='container'></div>
		</div>

	</template>
	<script>
	Polymer({
		is: 'adebray-skill-tree',

		attached: function () {
			let test = Object.keys(Magic).map( k => Object.keys(Magic[k]).map( e => `${k}.${e}`))

			console.log(test)

			let colors = Object.keys(Magic).concat(['Combat']).map( e => {
				let dot = document.createElement('color-dot')
				dot.colorhash = this.querySelector('color-hash')
				dot.text = e

				this.$.head.appendChild(dot)

				return {
					text: e,
					color: dot.customStyle['--custom-color']
				}
			})
			console.log(colors)

			var stage = new Konva.Stage({
				container : this.$$('#container'),
				width: 800 / 2,
				height: 600 / 2
			})
			layer = new Konva.Layer({
				draggable: true
			})

			stage.add(layer)
			layer.scale({x: 0.25, y: 0.25})

			let cmp = 0
			let stack = [{
				x: 0,
				y: 0
			}]
			let g_size = 32
			layer.add(new Konva.Rect({
				x: 0,
				y: 0,

				offsetX: g_size / 2,
				offsetY: g_size / 2,
				width: g_size,
				height: g_size,

				fill: 'black'
			}))

			let make_side = (_x, _y, depth = 0) => {
				var len = 4

				for (var i = 0; i < len; i++) {
					let p = (Math.PI * 2 / len) * i

					let j = parseInt(Math.random() * 2) + 1
					let size = g_size * j

					let __x = _x + Math.round( size * 2 * Math.cos(p) )
					let __y = _y + Math.round( size * 2 * Math.sin(p) )

					if ( stack.filter(({x, y}) => x == __x && y == __y ).length == 0 ) {
						let c = colors[parseInt(Math.random() * colors.length)]

						console.log(__x, __y)
						stack.push({
							x: __x,
							y: __y,
						})
						layer.add(new Konva.Rect({
							x: __x,
							y: __y,

							offsetX: size / 2,
							offsetY: size / 2,
							width: size,
							height: size,

							fill: c.color
						}))

					}

					if (depth < 1)
						make_side(__x, __y, depth + 1)
				}
			}

			make_side(0, 0)
			layer.draw()
			console.log(layer.children.length)

			layer.x( stage.width() / 2)
			layer.y( stage.height() / 2)
			layer.draw()
		}


	})
	</script>
</dom-module>
